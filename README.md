# Description
The car booking service is designed to reserve a car, its major logic is as below:
- A client sends necessary parameters to service, and then the service returns if it is successful or not.
````
Customer's identity, which must be located in http header.
A car model name.
A date customer wants to start to book.
Days customer wants to book.
````
- The identity info of client is attached to http header, which is caught by service side.

````
e.g. The login account of a customer.
````

- A table(T_CAR_INVENTORY) is used to store the data of all cars which are available to rent.

````
Each record in the table represents an available car.
````

- A table(T_CAR_RENTAL) is used to store the info of booking.

````
A record is inserted into it while at least a car is available.
````

- The service generates a unique token for each request in order to avoid multiple customers apply for a same car.

````
Java uuid is used for the unique token, which is generated by timestamp.
A record in the table(T_CAR_RENTAL) keeps the unique token util the entire process is finished. 
No matter what, the unique toke will be removed. 
````

- If customer book successfully, the status of a record in table(T_CAR_RENTAL) will be updated. at the same time a new record will be inserted into table(T_CAR_RENTAL). 

````
Only can successful booking update status of T_CAR_RENTAL and insert record of T_CAR_RENTAL.
````

- A schedule job is created to check the table(T_CAR_RENTAL) if the booking is overdue. if so the service recovers the status of table(T_CAR_INVENTORY) to available.

````
There could be an another solution. At the beginning not update the status, just remove the record in table(T_CAR_INVENTORY), then in the job task insert back the data in table (T_CAR_INVENTORY) when the conditions match.   
````

## Input

| name      | type   | description                                         | example  |
|-----------|--------|:----------------------------------------------------|----------|
| customer  | string | the current login user, which exists in http header | test     |
| carModel  | string | the model of car                                    | BMW 650  |
| dayOfRent | number | the days of renting a car                           | 1        |
| startDate | string | the date that start to rent a car                   | 20220324 |

## Output

| name      | type   | description                                     | example                                                                      |
|-----------|--------|:------------------------------------------------|------------------------------------------------------------------------------|
| code      | string | a code indicates whether the rent is successful | S<br/>E                                                                      |
| message   | string | more info to describe the code                  | Success<br/>Lack of storage<br/>No car model exists<br/>Date is out of range |

## Table
Name: T_CAR_INVENTORY

| column       |   type    |  PK   | nullable | index  |   default value   | remark                                                                                       |
|--------------|:---------:|:-----:|:--------:|:------:|:-----------------:|:---------------------------------------------------------------------------------------------|
| ID           |  bigint   |   Y   |    N     |        |                   | automatic increment                                                                          |
| NAME         |  varchar  |   N   |    Y     |        |                   | the name of a car                                                                            |
| STATUS       |  varchar  |   N   |    Y     |        |         0         | 0:available, 1:booked                                                                        |
| LOCK_ID      |  varchar  |   N   |    Y     |   Y    |                   | unique string for each request, which is used to avoid multiple thread handling same record. |
| CREATE_TIME  | timestamp |   N   |    Y     |        | current_timestamp | create time                                                                                  |
| CREATE_BY    |  varchar  |   N   |    Y     |        |                   | create by                                                                                    |

Name: T_CAR_RENTAL

| column        |    type    |  PK   | nullable | index |   default value   | remark                                                                                            |
|---------------|:----------:|:-----:|:--------:|:-----:|:-----------------:|:--------------------------------------------------------------------------------------------------|
| ID            |   bigint   |   Y   |    N     |       |                   | automatic increment                                                                               |
| CAR_ID        |   bigint   |   N   |    Y     |       |                   | the id of t_car_inventory                                                                         |
| CAR_MODEL     |  varchar   |   N   |    Y     |       |                   | the name of a car                                                                                 |
| CUSTOMER      |  varchar   |   N   |    Y     |       |                   | unique string for each request, which is used to avoid multiple thread handling same record.      |
| START_DATE    |    date    |   N   |    Y     |       |                   | a date that the customer wants to rent a car.                                                     |
| DAYS_OF_RENT  |    int     |   N   |    Y     |       |                   | how many days does the customer want to rent a car.                                               |
| DUE_DATE      |    date    |   N   |    Y     |       |                   | a date that the customer need to return the car, it is calculated by start_date and days_of_rent. |
| CREATE_TIME   | timestamp  |   N   |    Y     |       | current_timestamp | create time                                                                                       |
| CREATE_BY     |  varchar   |   N   |    Y     |       |                   | create by                                                                                         |




## URI
````
"customer" should be added in HTTP Header. 
/rentCar/{startDate}/{carModel}/{dayOfRent}
````

## Test Cases
1. As a customer who invokes the API, if each of parameters is correct, the service returns a json-based string like "{code: S, message: Success}".
2. As a customer who invokes the API, if no customer filed in http request, the service returns a json-based string like "{code: E, message: The customer doesn't exist!}".
3. As a customer who invokes the API, if a car model is not specified, the service returns a json-based string like "{code: E, message: The input [] is illegal!}".
4. As a customer who invokes the API, if input wrong a car model like "WrongCarModel", the service returns a json-based string like "{code: E, message: The input [WrongCarModel] is illegal!}".
5. As a customer who invokes the API, if a rent start date is not specified, the service returns a json-based string like "{code: E, message: The input [] is illegal!}".
6. As a customer who invokes the API, if input wrong rent start date like "2022-0332", the service returns a json-based string like "{code: E, message: The input [2022-0332] is illegal!}".
7. As a customer who invokes the API, if input days of rent as 0, The input number [0] should be a positive integer!}".
8. As a customer who invokes the API, if input negative days of rent like -1, The input number [-1] should be a positive integer!}".